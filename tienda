<?php
                // Obtener el ID del objeto y el precio
                $id_objeto = $_GET['id_objeto'];
                $precio = $_GET['precio'];
                $userID = $_SESSION['user_id'];

                // Consultar la cantidad de monedas del usuario
                $sql = "SELECT monedas FROM usuario WHERE id_user='$userID'";
                $result = $conn->query($sql);
                $user = $result->fetch_assoc();
                $monedas = $user['monedas'];

                if ($monedas >= $precio) {
                    // Deduce el precio del saldo del usuario
                    $nuevo_saldo = $monedas - $precio;

                    // Actualiza el saldo de monedas del usuario
                    $sql = "UPDATE usuario SET monedas='$nuevo_saldo' WHERE id_user='$userID'";
                    $conn->query($sql);

                    // Marca el objeto como comprado
                    $sql = "UPDATE objetos SET comprado=1 WHERE id_objeto='$id_objeto' AND userID='$userID'";
                    $conn->query($sql);

                    echo "Compra exitosa.";
                } else {
                    echo "No tienes suficientes monedas para realizar esta compra.";
                }

                $conn->close();
                header("Location: tienda.php"); // Redirige de vuelta a la tienda
            ?>
